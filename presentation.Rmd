---
title: "Why does preregistration increase the persuasiveness of evidence?"
subtitle: "A Bayesian rationalization"
author: 
  - "Aaron Peikert"
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    seal: false
    css: xaringan-themer.css
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
repro:
  packages:
    - xaringanthemer
    - showtext
    - svglite
    - patchwork
    - here
    - qrcode
---
class: center, middle
name: qrcode

```{r setup, include=FALSE}
library(xaringanthemer)
library(tidyverse)
library(patchwork)
library(qrcode)
options(htmltools.dir.version = FALSE)
knitr::read_chunk("R/plots.R")
knitr::opts_chunk$set(
  fig.width=9, fig.height=4, fig.retina=3,
  out.width = "100%",
  cache = FALSE,
  echo = FALSE,
  message = FALSE, 
  warning = FALSE,
  hiline = TRUE,
  dev = "svglite"
)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
primary_color <- "#024959"
secondary_color <- "#F28705"
style_duo(
  primary_color = primary_color,
  secondary_color = secondary_color,
  header_font_google = google_font("Didact Gothic", "400", "400i"),
  text_font_google   = google_font("IBM Plex Sans", "400", "400i"),
  text_font_size = "1.5rem",
  )

style_extra_css(css = list(".todo" = list(color = "#17C25B"),
                           ".optional" = list(color = "#05BCE6"),
                           ".large" = list(`font-size` = "130%"),
                           ".small" = list(`font-size` = "80%"),
                           ".enormous" = list(`font-size` = "1000%"),
                           ".full" = list(padding = "0px",
                                          margin = "0px",
                                          border = "0px"),
                           ".vertical" = list(`writing-mode` = "vertical-rl",
                                              `text-orientation` = "mixed"),
                           ".blurry" = list(color = "transparent",
                                            `text-shadow` = "0 0 5px rgba(0,0,0,0.5)")),
                )
```

```{r, echo=FALSE}
link <- "github.com/aaronpeikert/bayes-prereg"
```

```{r, echo=FALSE, out.width = "30%"}
fs::dir_create("images")
generate_svg(qr_code(link), here::here("images/", "qr_slides.svg"), foreground = secondary_color, background = primary_color, show = FALSE)
knitr::include_graphics("images/qr_slides.svg")
```

`r link`

.pull-right[![CC0](https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/cc-zero.svg)]

---
class: center, middle

# Why does preregistration increase the persuasiveness of evidence?

## A Bayesian rationalization

### Aaron Peikert

### 23rd Research Colloquium  | 09.11.2022

---
class: inverse, center, middle

# Why do we preregister?

???

An objective for preregistration.
If commiting to specific research question and data analysis before gathering data is to be a useful tool, we must know to what end we employ it.

If you are uncertain about why you should preregister, I hope to provide some clarity.
If you think you know why you should preregister, I hope to sow some doubt.

---

```{r, echo=FALSE}
crisis <- tribble(
  ~response, ~bin, ~prop,
  "Yes, a signicant crisis", "YES", .52,
  "Yes, a slight crisis", "YES", .38,
  "No, there is no crisis", "NO", .03,
  "Don’t know", "NA", 0.07
)

crisis_plot <- crisis %>%
  group_by(bin) %>%
  summarise(prop = sum(prop)) %>%
  ungroup() %>% 
  ggplot(aes(
    "response",
    prop,
    fill = bin,
    label = bin,
    size = prop
  )) +
  geom_col() +
  geom_text(position = position_stack(vjust = 0.5)) +
  coord_flip() +
  theme_void() +
  theme(
    legend.position = "none",
    panel.background = element_rect(fill = "transparent", colour = NA),
    plot.background = element_rect(fill = "transparent", colour = NA)
  ) +
  scale_y_continuous(expand=c(0,0)) +
  scale_x_discrete(expand=c(0,0), limits = NULL) +
  scale_fill_manual(values = c("YES" = "#E3350E", "NO" = "#F28705", "NA" = "lightgrey")) +
  scale_size_continuous(range = c(4, 20)) +
  NULL
```

## Is there a replication crisis?*

.center[

```{r, out.width = '70%'}
crisis_plot /
  (crisis_plot +
     aes(label = str_c(prop * 100, "%")) + 
     scale_size_continuous(range = c(3, 12))) + 
  plot_layout(heights = c(.7, .3)) + 
  plot_annotation(theme = theme_void() + theme(
    panel.background = element_rect(fill = "transparent", colour = NA),
    plot.background = element_rect(fill = "transparent", colour = NA)
))

```
]

.small.right[Baker, M. 1,500 scientists lift the lid on reproducibility. *Nature* 533, 452–454 (2016). https://doi.org/10.1038/533452a]

???

The simple answer is that we preregister because we think it is a remedy against the replication crisis.

---
class: inverse, center, middle

# Traditional view

---
class: center

# Preregistration separates:

.pull-left.center[

# confirmatory

]

.pull-right.center[

# exploratory

]

.pull-left.center[

# ≈

# preregistered

]

.pull-right.center[


# ≈

# not preregistered

]

---
class: center, middle

## Obvious problems:

1. not a principled rational
2. vagueness of prediction is not accounted for
3. what about changes after the preregistration

---
class: inverse, center, middle

# A Formal Objective*

*Statisticians' Edition

---

### How we judge a model:

Sampling the world and compare:

$$
L(\text{Model}(\text{Train}), \text{Train}) + \mathcal{C}(\text{Model})
$$
e.g.: Adjusted R², Stein's Unbiased Risk Estimator, Information Criteria, etc.

.center[

**We account for peeking at the data**

]

---

### Alternatively:

The statistical complexity of some models is hard to estimate.

Find a situation, were $\mathcal{C}(\text{Model}) = 0$

--

$$
L(\text{Model}(\text{Train, Test}), \text{Test})
$$
.center[

**There is no peeking to account for.**

]


---

### How we judge a theory:

$$L(\text{Theory}, \text{Train})$$
--

We often replace a theory by a model:

$$
L(\text{Model}(\text{Theory,Train}), \text{Train}) + \mathcal{C}(\text{Model})
$$
--

Who are we kidding?

$$
L(\text{Model}(\text{Theory,Train}), \text{Train}) + \mathcal{C}(\text{Model}) + \mathcal{C}(\text{Human})
$$
---
## $\mathcal{C}(\text{Human})$

The statistical complexity of humans is hard to estimate.

Find a situation, were $\mathcal{C}(\text{Human}) = 0$

--

.center[
# Preregistration
]

---
class: center, middle, inverse

# .blurry[Uncertainty]

---
class: center, middle


# $\infty$ loss functions

---
class: center, middle, inverse

# Practice

---
class: center, middle
name: theoretical-risk-plot2

```{r}
results <- readr::read_rds(here::here("data", "simulation.rds")) 
```

```{r measure-plots}
# see R/plots.R
```

```{r}
plots[["Posterior Probability"]] +
  xaringanthemer::theme_xaringan() +
    theme(legend.position = c(.2, .8),
        legend.title = element_blank(),
        text = element_text(size = 18, color = secondary_color),
        title = element_blank(),
        axis.title = element_text(size = 18),
        plot.caption = element_text(size = 15)) +
  labs(x = "Theoretical Risk",
       y = "Posterior Probability",
       caption = "P(E|H) = .8, P(H) = .1") +
  NULL
```

---
class: center, middle
layout: true
---

.large[**Preregistrations**] reduce .large[**uncertainty**] about .large[**theoretical risk**].

---

# Can I explore the data?

--

# Yes.

---
template: theoretical-risk-plot2

---

# Can I deviate?

--

# Sometimes.

---
template: theoretical-risk-plot2

---

# How much detail?

--

# Very detailed.

---
template: theoretical-risk-plot2

---
template: qrcode

---

### One further idea

---

# Preregistration as Code

### version control + dynamic documents

---
class: center

.pull-left[

### Standard Preregistration

hunches

↓

preregistration

↓

data

↓

article draft
]

.pull-right[
### Preregistration as Code

simulated data

↓

article draft with mock results

↓

data

↓

article draft with real results

]

---
template: qrcode
